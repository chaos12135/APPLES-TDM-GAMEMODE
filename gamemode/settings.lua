-- SERVER SIDE

resource.AddSingleFile( "sound/apples_tdm_gm/final_count.mp3" )
resource.AddSingleFile( "sound/apples_tdm_gm/wedding.mp3" )
resource.AddSingleFile( "materials/apple_hud/armoricon.png" )
resource.AddSingleFile( "materials/apple_hud/hpicon.png" )

/*
resource.AddSingleFile( "sound/effect/balloon_pop.wav" )
resource.AddSingleFile( "materials/effect/balloon001.vmt" )
resource.AddSingleFile( "materials/effect/balloon001.vtf" )
resource.AddSingleFile( "materials/effect/heart.vmt" )
resource.AddSingleFile( "materials/effect/heart.vtf" )
resource.AddSingleFile( "materials/scope/scope_normal.vmt" )
resource.AddSingleFile( "materials/scope/scope_normal.vtf" )
resource.AddSingleFile( "materials/scope/scope_reddot.vmt" )
resource.AddSingleFile( "materials/scope/scope_reddot.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_admin_weapon.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_admin_weapon.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_ak47.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_ak47.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_aug.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_aug.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_awp.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_awp.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_desert_eagle.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_desert_eagle.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_elites.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_elites.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_famas.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_famas.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_five-seven.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_five-seven.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_flash.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_flash.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_g3sg1.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_g3sg1.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_galil.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_galil.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_glock18.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_glock18.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_grenade.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_grenade.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_knife.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_knife.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_m249.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_m249.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_m4a1.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_m4a1.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_mac10.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_mac10.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_mp5a4.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_mp5a4.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_mp5a5.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_mp5a5.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_p228.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_p228.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_p90.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_p90.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_pumpshotgun.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_pumpshotgun.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_scout.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_scout.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_sg550.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_sg550.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_sg552.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_sg552.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_smoke.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_smoke.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_tmp.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_tmp.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_ump_45.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_ump_45.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_usp.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_usp.vtf" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_xm1014.vmt" )
resource.AddSingleFile( "materials/vgui/entities/weapon_real_cs_xm1014.vtf" )
*/

/*
for k, v in pairs(file.Find("maps/test2/*", "MOD")) do
	MsgN('resource.AddSingleFile( "materials/vgui/entities/'..v..'" )')
end
*/

util.PrecacheSound("sound/apples_tdm_gm/final_count.mp3")
util.PrecacheSound("sound/apples_tdm_gm/wedding.mp3")

hook.Add( "PostGamemodeLoaded", "PostGamemodeLoadedSettingsDB", function(ply)
	timer.Simple(3, function()
		CreateSettingsDB()
		CreateMapsDB()
	end)
end)


function CreateSettingsDB()
	local GENERICA_SETTINGS = sql.Query( "SELECT * from apple_deathmatch_settings;" )
	if GENERICA_SETTINGS == nil then return end
	if sql.TableExists("apple_deathmatch_settings") == false then
		sql.Query( "CREATE TABLE apple_deathmatch_settings ( ID int, Type varchar(255), Value varchar(255) )" )
	end
		if sql.QueryValue( "SELECT ID FROM apple_deathmatch_settings WHERE ID = '1';" ) == nil then
			sql.Query( "INSERT INTO apple_deathmatch_settings ( `ID`, `Type`, `Value`) VALUES ( '1', 'Score', '50')" )
		end
		if sql.QueryValue( "SELECT ID FROM apple_deathmatch_settings WHERE ID = '2';" ) == nil then
			sql.Query( "INSERT INTO apple_deathmatch_settings ( `ID`, `Type`, `Value`) VALUES ( '2', 'Time', '5')" )
		end
		if sql.QueryValue( "SELECT ID FROM apple_deathmatch_settings WHERE ID = '3';" ) == nil then
			sql.Query( "INSERT INTO apple_deathmatch_settings ( `ID`, `Type`, `Value`) VALUES ( '3', 'Intro', "..sql.SQLStr('https://ia601508.us.archive.org/35/items/njoin2/njoin2.mp3')..")" )
		end
		if sql.QueryValue( "SELECT ID FROM apple_deathmatch_settings WHERE ID = '4';" ) == nil then
			sql.Query( "INSERT INTO apple_deathmatch_settings ( `ID`, `Type`, `Value`) VALUES ( '4', 'IntroChk', '1')" )
		end
		if sql.QueryValue( "SELECT ID FROM apple_deathmatch_settings WHERE ID = '5';" ) == nil then
			sql.Query( "INSERT INTO apple_deathmatch_settings ( `ID`, `Type`, `Value`) VALUES ( '5', 'IntroTime', '25')" )
		end
		if sql.QueryValue( "SELECT ID FROM apple_deathmatch_settings WHERE ID = '6';" ) == nil then
			sql.Query( "INSERT INTO apple_deathmatch_settings ( `ID`, `Type`, `Value`) VALUES ( '6', 'ShowSpawns', '1')" )
		end
		if sql.QueryValue( "SELECT ID FROM apple_deathmatch_settings WHERE ID = '7';" ) == nil then
			sql.Query( "INSERT INTO apple_deathmatch_settings ( `ID`, `Type`, `Value`) VALUES ( '7', 'RewardLevel', '100')" )
		end
		if sql.QueryValue( "SELECT ID FROM apple_deathmatch_settings WHERE ID = '8';" ) == nil then
			sql.Query( "INSERT INTO apple_deathmatch_settings ( `ID`, `Type`, `Value`) VALUES ( '8', 'RewardLevelMutli', '1')" )
		end
		if sql.QueryValue( "SELECT ID FROM apple_deathmatch_settings WHERE ID = '9';" ) == nil then
			sql.Query( "INSERT INTO apple_deathmatch_settings ( `ID`, `Type`, `Value`) VALUES ( '9', 'RewardLevelSound', "..sql.SQLStr('https://ia601506.us.archive.org/17/items/levelup_201506/levelup.mp3')..")" )
		end
		if sql.QueryValue( "SELECT ID FROM apple_deathmatch_settings WHERE ID = '10';" ) == nil then
			sql.Query( "INSERT INTO apple_deathmatch_settings ( `ID`, `Type`, `Value`) VALUES ( '10', 'RewardLevelSoundTime', '12')" )
		end
		if sql.QueryValue( "SELECT ID FROM apple_deathmatch_settings WHERE ID = '11';" ) == nil then
			sql.Query( "INSERT INTO apple_deathmatch_settings ( `ID`, `Type`, `Value`) VALUES ( '11', 'Classes', '0')" )
		end
end



function CreateMapsDB()
	local GENERICA_SETTINGS_MAPS = sql.Query( "SELECT * from apple_deathmatch_maplist;" )
	if GENERICA_SETTINGS_MAPS == nil then return end
	if sql.TableExists("apple_deathmatch_maplist") == false then
		sql.Query( "CREATE TABLE apple_deathmatch_maplist ( ID int, Map varchar(255) )" )
		sql.Query( "INSERT INTO apple_deathmatch_maplist ( `ID`, `Map`) VALUES ( '1', 'gm_construct')" )
		MsgN("Creating setting : maplist")
	end
end


/*
function CreateSpectatingDB()
	local GENERICA_SPECY = sql.Query( "SELECT * from apple_deathmatch_active_players;" )
	if GENERICA_SPECY == nil then return end
	if sql.TableExists(GENERICA_SPECY) == false then
		sql.Query( "CREATE TABLE apple_deathmatch_active_players ( ID int, PlayerID varchar(255), Kills int, TeamID int )" )
		if sql.LastError() != nil then
			 -- MsgN("settings.lua: "..sql.LastError())
		end
	end
end



function AddToSpectator(ply)
	timer.Simple(5, function()
		sql.Query( "INSERT INTO apple_deathmatch_active_players ( `ID`, `PlayerID`, `Kills`, `TeamID`) VALUES ( '1', "..(sql.SQLStr(ply:UniqueID()))..", '0', "..(tonumber(ply:Team()))..")" )
	end)
end
hook.Add( "PlayerInitialSpawn", "AddToSpectator", AddToSpectator)
*/